{
  "workflowName": "PullRequestReview",
  "description": "Comprehensive workflow for pull request reviews with integrations",
  "version": "2.0",
  "fileName": "pull-request-workflow.json",
  "triggers": {
    "events": [
      "pull_request.opened",
      "pull_request.synchronize",
      "manual_review"
    ]
  },
  "workflow": {
    "steps": [
      {
        "id": "code_review",
        "name": "AI Code Review",
        "plugin": "CodeReview",
        "function": "ReviewPullRequest",
        "required": true,
        "parameters": {
          "includeSecurityCheck": true,
          "includeComplexityAnalysis": true,
          "includeTestCoverage": true
        }
      },
      {
        "id": "github_comment",
        "name": "Post GitHub Comment",
        "plugin": "GitHub",
        "function": "PostPullRequestComment",
        "required": true,
        "dependsOn": ["code_review"],
        "parameters": {
          "template": "pr-review-template",
          "includeMetrics": true,
          "tagReviewers": true,
          "reviewData": "{{results.code_review.result}}"
        }
      },
      {
        "id": "jira_smart_ticket",
        "name": "Smart JIRA Ticket Handling",
        "plugin": "Jira",
        "function": "HandleCodeReviewTicket",
        "required": false,
        "dependsOn": ["code_review"],
        "conditions": {},
        "parameters": {
          "prTitle": "{{data.prTitle}}",
          "prNumber": "{{data.prNumber}}",
          "reviewSummary": "{{results.code_review.summary}}",
          "issueCount": "{{results.code_review.issueCount}}",
          "project": "KAN",
          "issueType": "Task",
          "priority": "High"
        }
      },
      {
        "id": "teams_notification",
        "name": "Teams Notification",
        "plugin": "Teams",
        "function": "SendAdaptiveCard",
        "required": false,
        "dependsOn": ["code_review"],
        "conditions": {},
        "parameters": {
          "channel": "dev-reviews",
          "template": "critical-issues-alert",
          "mentionTeam": true
        }
      },
      {
        "id": "approval_check",
        "name": "Auto Approval Check",
        "plugin": "GitHub",
        "function": "SetPullRequestStatus",
        "required": false,
        "dependsOn": ["code_review"],
        "conditions": {
          "noHighSeverityIssues": true,
          "hasTests": true,
          "complexity": "Low|Medium"
        },
        "parameters": {
          "status": "approved",
          "message": "Auto-approved: No critical issues found"
        }
      }
    ]
  },
  "templates": {
    "pr-review-template": "## ğŸ¤– AI Code Review Results\n\nğŸ“‹ **Summary**\n{{summary}}\n\nğŸ“Š **Review Metrics**\n{{metrics}}\n\n### ğŸ” Issues Found\n{{#each issues}}\nğŸŸ¡ **{{severity}}**: {{message}} ({{file}}:{{line}})\nğŸ’¡ {{suggestion}}\n\n{{/each}}\n\n### ğŸ“‹ Next Steps\nPlease review the findings above and address any issues identified. Focus on high and medium priority items first.\n\n### ğŸ”— Integration Status\nâœ… GitHub comment posted\nğŸ« {{#if jiraTicketResult}}{{jiraTicketResult}}{{else}}Jira ticket handled (updated existing or created new){{/if}}\nğŸ“¢ Team notified via Teams\nğŸ” Pull request status updated\n\n---\n*This comment was automatically generated by the AI Code Reviewer workflow.*\n*Repository: {{repository}}*\n*Timestamp: {{timestamp}}*",
    "critical-issues-alert": "ğŸš¨ **Code Review Alert**\n\n**PR #{{prNumber}}**: {{prTitle}}\n\n**Issues Found**: {{issueCount}}\n\nPlease review and address the identified issues."
  }
}
